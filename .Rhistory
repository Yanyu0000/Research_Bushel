)
View(Corn_future)
Soybean_future <- ag_future %>%
mutate(tradingDay = as.Date(Date)) %>%
rename(soybean_future = soybean_price) %>%
select(-Date,-corn_price,-corn_return,-wheat_price,-wheat_return) %>%
mutate(
soybean_future_1 = lag(soybean_future,1),
soybean_return_1 = lag(soybean_return,1),
soybean_future_2 = lag(soybean_future,2),
soybean_return_2 = lag(soybean_return,2),
soybean_future_3 = lag(soybean_future,3),
soybean_return_3 = lag(soybean_return,3),
soybean_future_4 = lag(soybean_future,4),
soybean_return_4 = lag(soybean_return,4),
soybean_future_5 = lag(soybean_future,5),
soybean_return_5 = lag(soybean_return,5),
soybean_future_6 = lag(soybean_future,6),
soybean_return_6 = lag(soybean_return,6)
)
View(Soybean_future)
Wheat_future <- ag_future %>%
mutate(tradingDay = as.Date(Date)) %>%
rename(wheat_future = wheat_price) %>%
select(-Date,-corn_price,-corn_return,-soybean_price,-soybean_return) %>%
mutate(
wheat_future_1 = lag(wheat_future,1),
wheat_return_1 = lag(wheat_return,1),
wheat_future_2 = lag(wheat_future,2),
wheat_return_2 = lag(wheat_return,2),
wheat_future_3 = lag(wheat_future,3),
wheat_return_3 = lag(wheat_return,3),
wheat_future_4 = lag(wheat_future,4),
wheat_return_4 = lag(wheat_return,4),
wheat_future_5 = lag(wheat_future,5),
wheat_return_5 = lag(wheat_return,5),
wheat_future_6 = lag(wheat_future,6),
wheat_return_6 = lag(wheat_return,6)
)
View(Corn_future)
View(Corn_future)
View(cotton_future)
Cotton_future <- read_csv(file.choose())
Hog_future <- read_csv(file.choose())
Cattle_future <- read_csv(file.choose())
colnames(Cotton_future)
Cotton_future<- Cotton_future  %>%
mutate(tradingDay = as.Date(Time)) %>%
rename(cotton_future = Last) %>%
rename(cotton_return = Returns) %>%
select(-Time,-CommodityCode,-ContractMonth,-YearCode,-Roll_Flag) %>%
mutate(
cotton_future_1 = lag(cotton_future,1),
cotton_return_1 = lag(cotton_return,1),
cotton_future_2 = lag(cotton_future,2),
cotton_return_2 = lag(cotton_return,2),
cotton_future_3 = lag(cotton_future,3),
cotton_return_3 = lag(cotton_return,3),
cotton_future_4 = lag(cotton_future,4),
cotton_return_4 = lag(cotton_return,4),
cotton_future_5 = lag(cotton_future,5),
cotton_return_5 = lag(cotton_return,5),
cotton_future_6 = lag(cotton_future,6),
cotton_return_6 = lag(cotton_return,6)
)
View(Cotton_future)
View(Hog_future)
Hog_future <- Hog_future  %>%
mutate(tradingDay = as.Date(Time)) %>%
rename(hog_future = Last) %>%
rename(hog_return = Returns) %>%
select(-Time,-CommodityCode,-ContractMonth,-YearCode,-Roll_Flag) %>%
mutate(
hog_future_1 = lag(hog_future,1),
hog_return_1 = lag(hog_return,1),
hog_future_2 = lag(hog_future,2),
hog_return_2 = lag(hog_return,2),
hog_future_3 = lag(hog_future,3),
hog_return_3 = lag(hog_return,3),
hog_future_4 = lag(hog_future,4),
hog_return_4 = lag(hog_return,4),
hog_future_5 = lag(hog_future,5),
hog_return_5 = lag(hog_return,5),
hog_future_6 = lag(hog_future,6),
hog_return_6 = lag(hog_return,6)
)
View(Cattle_future)
hog
Cattle_future <- Cattle_future  %>%
mutate(tradingDay = as.Date(Time)) %>%
rename(cattle_future = Last) %>%
rename(cattle_return = Returns) %>%
select(-Time,-CommodityCode,-ContractMonth,-YearCode,-Roll_Flag) %>%
mutate(
cattle_future_1 = lag(cattle_future,1),
cattle_return_1 = lag(cattle_return,1),
cattle_future_2 = lag(cattle_future,2),
cattle_return_2 = lag(cattle_return,2),
cattle_future_3 = lag(cattle_future,3),
cattle_return_3 = lag(cattle_return,3),
cattle_future_4 = lag(cattle_future,4),
cattle_return_4 = lag(cattle_return,4),
cattle_future_5 = lag(cattle_future,5),
cattle_return_5 = lag(cattle_return,5),
cattle_future_6 = lag(cattle_future,6),
cattle_return_6 = lag(cattle_return,6)
)
View(Cattle_future)
View(Corn)
View(Corn_future)
Hogs_future <- Hog_future  %>%
mutate(tradingDay = as.Date(Time)) %>%
rename(hog_future = Last) %>%
rename(hog_return = Returns) %>%
select(-Time,-CommodityCode,-ContractMonth,-YearCode,-Roll_Flag) %>%
mutate(
hog_future_1 = lag(hog_future,1),
hog_return_1 = lag(hog_return,1),
hog_future_2 = lag(hog_future,2),
hog_return_2 = lag(hog_return,2),
hog_future_3 = lag(hog_future,3),
hog_return_3 = lag(hog_return,3),
hog_future_4 = lag(hog_future,4),
hog_return_4 = lag(hog_return,4),
hog_future_5 = lag(hog_future,5),
hog_return_5 = lag(hog_return,5),
hog_future_6 = lag(hog_future,6),
hog_return_6 = lag(hog_return,6)
)
########## expecatation project ##########
library(readxl)
library(timeDate)
library(dplyr)
library(lubridate)
library(purrr)
library(nnet)
# survey data #
dat <- read_excel(file.choose())  # NOTE: input the survey data by manual selection
dat <- dat %>%
mutate(tradingDay = as.Date(Date, format = "%y%m%d")) %>%
select(-Date,-`Est GFI`,-`GFI Score`,-CSS_CellCode,-CSS_BadNpaNxx)
# price contract data #
# NOTE: change the path of contract data
# cash contract
Corn <- read.csv("/Users/yanyuma/Downloads/0research/05 Ag Barometer Data /Data/cash contract/Corn_Y00.csv")
Cotton <- read.csv("/Users/yanyuma/Downloads/0research/05 Ag Barometer Data /Data/cash contract/Cotton_Y00.csv")
Hogs <- read.csv("/Users/yanyuma/Downloads/0research/05 Ag Barometer Data /Data/cash contract/Lean_Hogs_Y00.csv")
Cattle <- read.csv("/Users/yanyuma/Downloads/0research/05 Ag Barometer Data /Data/cash contract/Live_Cattle_Y00.csv")
Soybeans <- read.csv("/Users/yanyuma/Downloads/0research/05 Ag Barometer Data /Data/cash contract/Soybeans_Y00.csv")
Wheat <- read.csv("/Users/yanyuma/Downloads/0research/05 Ag Barometer Data /Data/cash contract/Wheat_Y00.csv")
Corn <- Corn %>%
mutate(tradingDay = as.Date(tradingDay)) %>%
rename(#corn_open = open,
#corn_high = high,
#corn_low = low,
corn = close) %>%
select(-symbol,-timestamp,-open,-high,-low,-volume,-openInterest) %>%
mutate(
# corn_open_1 = lag(corn_open,1),
# corn_high_1 = lag(corn_high,1),
# corn_low_1 = lag(corn_low,1),
corn_1 = lag(corn,1),
# corn_open_2 = lag(corn_open,2),
# corn_high_2 = lag(corn_high,2),
# corn_low_2 = lag(corn_low,2),
corn_2 = lag(corn,2),
# corn_open_3 = lag(corn_open,3),
# corn_high_3 = lag(corn_high,3),
# corn_low_3 = lag(corn_low,3),
corn_3 = lag(corn,3),
# corn_open_4 = lag(corn_open,4),
# corn_high_4 = lag(corn_high,4),
# corn_low_4 = lag(corn_low,4),
corn_4 = lag(corn,4),
# corn_open_5 = lag(corn_open,5),
# corn_high_5 = lag(corn_high,5),
# corn_low_5 = lag(corn_low,5),
corn_5 = lag(corn,5),
# corn_open_6 = lag(corn_open,6),
# corn_high_6 = lag(corn_high,6),
# corn_low_6 = lag(corn_low,6),
corn_6 = lag(corn,6),
)
Cotton <- Cotton %>%
mutate(tradingDay = mdy(Date)) %>%
rename(#cotton_open = open,
#cotton_high = high,
#cotton_low = low,
cotton = close) %>%
select(-symbol,-Date,-open,-high,-low) %>%
mutate(
# cotton_open_1 = lag(cotton_open,1),
# cotton_high_1 = lag(cotton_high,1),
# cotton_low_1 = lag(cotton_low,1),
cotton_1 = lag(cotton,1),
# cotton_open_2 = lag(cotton_open,2),
# cotton_high_2 = lag(cotton_high,2),
# cotton_low_2 = lag(cotton_low,2),
cotton_2 = lag(cotton,2),
# cotton_open_3 = lag(cotton_open,3),
# cotton_high_3 = lag(cotton_high,3),
# cotton_low_3 = lag(cotton_low,3),
cotton_3 = lag(cotton,3),
# cotton_open_4 = lag(cotton_open,4),
# cotton_high_4 = lag(cotton_high,4),
# cotton_low_4 = lag(cotton_low,4),
cotton_4 = lag(cotton,4),
# cotton_open_5 = lag(cotton_open,5),
# cotton_high_5 = lag(cotton_high,5),
# cotton_low_5 = lag(cotton_low,5),
cotton_5 = lag(cotton,5),
# cotton_open_6 = lag(cotton_open,6),
# cotton_high_6 = lag(cotton_high,6),
# cotton_low_6 = lag(cotton_low,6),
cotton_6 = lag(cotton,6),
)
Hogs <- Hogs %>%
mutate(tradingDay = as.Date(tradingDay)) %>%
rename(#hogs_open = open,
#hogs_high = high,
#hogs_low = low,
hogs = close) %>%
select(-symbol,-timestamp,-open,-high,-low,-volume,-openInterest) %>%
mutate(
# hogs_open_1 = lag(hogs_open,1),
# hogs_high_1 = lag(hogs_high,1),
# hogs_low_1 = lag(hogs_low,1),
hogs_1 = lag(hogs,1),
# hogs_open_2 = lag(hogs_open,2),
# hogs_high_2 = lag(hogs_high,2),
# hogs_low_2 = lag(hogs_low,2),
hogs_2 = lag(hogs,2),
# hogs_open_3 = lag(hogs_open,3),
# hogs_high_3 = lag(hogs_high,3),
# hogs_low_3 = lag(hogs_low,3),
hogs_3 = lag(hogs,3),
# hogs_open_4 = lag(hogs_open,4),
# hogs_high_4 = lag(hogs_high,4),
# hogs_low_4 = lag(hogs_low,4),
hogs_4 = lag(hogs,4),
# hogs_open_5 = lag(hogs_open,5),
# hogs_high_5 = lag(hogs_high,5),
# hogs_low_5 = lag(hogs_low,5),
hogs_5 = lag(hogs,5),
# hogs_open_6 = lag(hogs_open,6),
# hogs_high_6 = lag(hogs_high,6),
# hogs_low_6 = lag(hogs_low,6),
hogs_6 = lag(hogs,6),
)
Cattle <- Cattle %>%
mutate(tradingDay = as.Date(tradingDay)) %>%
rename(#cattle_open = open,
#cattle_high = high,
#cattle_low = low,
cattle = close) %>%
select(-symbol,-timestamp,-open,-high,-low,-volume,-openInterest) %>%
mutate(
# cattle_open_1 = lag(cattle_open,1),
# cattle_high_1 = lag(cattle_high,1),
# cattle_low_1 = lag(cattle_low,1),
cattle_1 = lag(cattle,1),
# cattle_open_2 = lag(cattle_open,2),
# cattle_high_2 = lag(cattle_high,2),
# cattle_low_2 = lag(cattle_low,2),
cattle_2 = lag(cattle,2),
# cattle_open_3 = lag(cattle_open,3),
# cattle_high_3 = lag(cattle_high,3),
# cattle_low_3 = lag(cattle_low,3),
cattle_3 = lag(cattle,3),
# cattle_open_4 = lag(cattle_open,4),
# cattle_high_4 = lag(cattle_high,4),
# cattle_low_4 = lag(cattle_low,4),
cattle_4 = lag(cattle,4),
# cattle_open_5 = lag(cattle_open,5),
# cattle_high_5 = lag(cattle_high,5),
# cattle_low_5 = lag(cattle_low,5),
cattle_5 = lag(cattle,5),
# cattle_open_6 = lag(cattle_open,6),
# cattle_high_6 = lag(cattle_high,6),
# cattle_low_6 = lag(cattle_low,6),
cattle_6 = lag(cattle,6),
)
Soybeans <- Soybeans %>%
mutate(tradingDay = as.Date(tradingDay)) %>%
rename(#soybeans_open = open,
#soybeans_high = high,
#soybeans_low = low,
soybeans = close) %>%
select(-symbol,-timestamp,-open,-high,-low,-volume,-openInterest) %>%
mutate(
# soybeans_open_1 = lag(soybeans_open,1),
# soybeans_high_1 = lag(soybeans_high,1),
# soybeans_low_1 = lag(soybeans_low,1),
soybeans_1 = lag(soybeans,1),
# soybeans_open_2 = lag(soybeans_open,2),
# soybeans_high_2 = lag(soybeans_high,2),
# soybeans_low_2 = lag(soybeans_low,2),
soybeans_2 = lag(soybeans,2),
# soybeans_open_3 = lag(soybeans_open,3),
# soybeans_high_3 = lag(soybeans_high,3),
# soybeans_low_3 = lag(soybeans_low,3),
soybeans_3 = lag(soybeans,3),
# soybeans_open_4 = lag(soybeans_open,4),
# soybeans_high_4 = lag(soybeans_high,4),
# soybeans_low_4 = lag(soybeans_low,4),
soybeans_4 = lag(soybeans,4),
# soybeans_open_5 = lag(soybeans_open,5),
# soybeans_high_5 = lag(soybeans_high,5),
# soybeans_low_5 = lag(soybeans_low,5),
soybeans_5 = lag(soybeans,5),
# soybeans_open_6 = lag(soybeans_open,6),
# soybeans_high_6 = lag(soybeans_high,6),
# soybeans_low_6 = lag(soybeans_low,6),
soybeans_6 = lag(soybeans,6),
)
Wheat <- Wheat %>%
mutate(tradingDay = as.Date(tradingDay)) %>%
rename(#wheat_open = open,
#wheat_high = high,
#wheat_low = low,
wheat = close) %>%
select(-symbol,-timestamp,-open,-high,-low,-volume,-openInterest)  %>%
mutate(
# wheat_open_1 = lag(wheat_open,1),
# wheat_high_1 = lag(wheat_high,1),
# wheat_low_1 = lag(wheat_low,1),
wheat_1 = lag(wheat,1),
# wheat_open_2 = lag(wheat_open,2),
# wheat_high_2 = lag(wheat_high,2),
# wheat_low_2 = lag(wheat_low,2),
wheat_2 = lag(wheat,2),
# wheat_open_3 = lag(wheat_open,3),
# wheat_high_3 = lag(wheat_high,3),
# wheat_low_3 = lag(wheat_low,3),
wheat_3 = lag(wheat,3),
# wheat_open_4 = lag(wheat_open,4),
# wheat_high_4 = lag(wheat_high,4),
# wheat_low_4 = lag(wheat_low,4),
wheat_4 = lag(wheat,4),
# wheat_open_5 = lag(wheat_open,5),
# wheat_high_5 = lag(wheat_high,5),
# wheat_low_5 = lag(wheat_low,5),
wheat_5 = lag(wheat,5),
# wheat_open_6 = lag(wheat_open,6),
# wheat_high_6 = lag(wheat_high,6),
# wheat_low_6 = lag(wheat_low,6),
wheat_6 = lag(wheat,6),
)
# future
ag_future <- read_excel(file.choose())   # NOTE: input the survey data by manual selection
Cotton_future <- read_csv(file.choose())
Hog_future <- read_csv(file.choose())
Cattle_future <- read_csv(file.choose())
Corn_future <- ag_future %>%
mutate(tradingDay = as.Date(Date)) %>%
rename(corn_future = corn_price) %>%
select(-Date,-soybean_price,-soybean_return,-wheat_price,-wheat_return) %>%
mutate(
corn_future_1 = lag(corn_future,1),
corn_return_1 = lag(corn_return,1),
corn_future_2 = lag(corn_future,2),
corn_return_2 = lag(corn_return,2),
corn_future_3 = lag(corn_future,3),
corn_return_3 = lag(corn_return,3),
corn_future_4 = lag(corn_future,4),
corn_return_4 = lag(corn_return,4),
corn_future_5 = lag(corn_future,5),
corn_return_5 = lag(corn_return,5),
corn_future_6 = lag(corn_future,6),
corn_return_6 = lag(corn_return,6)
)
Soybeans_future <- ag_future %>%
mutate(tradingDay = as.Date(Date)) %>%
rename(soybean_future = soybean_price) %>%
select(-Date,-corn_price,-corn_return,-wheat_price,-wheat_return) %>%
mutate(
soybean_future_1 = lag(soybean_future,1),
soybean_return_1 = lag(soybean_return,1),
soybean_future_2 = lag(soybean_future,2),
soybean_return_2 = lag(soybean_return,2),
soybean_future_3 = lag(soybean_future,3),
soybean_return_3 = lag(soybean_return,3),
soybean_future_4 = lag(soybean_future,4),
soybean_return_4 = lag(soybean_return,4),
soybean_future_5 = lag(soybean_future,5),
soybean_return_5 = lag(soybean_return,5),
soybean_future_6 = lag(soybean_future,6),
soybean_return_6 = lag(soybean_return,6)
)
Wheat_future <- ag_future %>%
mutate(tradingDay = as.Date(Date)) %>%
rename(wheat_future = wheat_price) %>%
select(-Date,-corn_price,-corn_return,-soybean_price,-soybean_return) %>%
mutate(
wheat_future_1 = lag(wheat_future,1),
wheat_return_1 = lag(wheat_return,1),
wheat_future_2 = lag(wheat_future,2),
wheat_return_2 = lag(wheat_return,2),
wheat_future_3 = lag(wheat_future,3),
wheat_return_3 = lag(wheat_return,3),
wheat_future_4 = lag(wheat_future,4),
wheat_return_4 = lag(wheat_return,4),
wheat_future_5 = lag(wheat_future,5),
wheat_return_5 = lag(wheat_return,5),
wheat_future_6 = lag(wheat_future,6),
wheat_return_6 = lag(wheat_return,6)
)
Cotton_future <- Cotton_future  %>%
mutate(tradingDay = as.Date(Time)) %>%
rename(cotton_future = Last) %>%
rename(cotton_return = Returns) %>%
select(-Time,-CommodityCode,-ContractMonth,-YearCode,-Roll_Flag) %>%
mutate(
cotton_future_1 = lag(cotton_future,1),
cotton_return_1 = lag(cotton_return,1),
cotton_future_2 = lag(cotton_future,2),
cotton_return_2 = lag(cotton_return,2),
cotton_future_3 = lag(cotton_future,3),
cotton_return_3 = lag(cotton_return,3),
cotton_future_4 = lag(cotton_future,4),
cotton_return_4 = lag(cotton_return,4),
cotton_future_5 = lag(cotton_future,5),
cotton_return_5 = lag(cotton_return,5),
cotton_future_6 = lag(cotton_future,6),
cotton_return_6 = lag(cotton_return,6)
)
Hogs_future <- Hog_future  %>%
mutate(tradingDay = as.Date(Time)) %>%
rename(hog_future = Last) %>%
rename(hog_return = Returns) %>%
select(-Time,-CommodityCode,-ContractMonth,-YearCode,-Roll_Flag) %>%
mutate(
hog_future_1 = lag(hog_future,1),
hog_return_1 = lag(hog_return,1),
hog_future_2 = lag(hog_future,2),
hog_return_2 = lag(hog_return,2),
hog_future_3 = lag(hog_future,3),
hog_return_3 = lag(hog_return,3),
hog_future_4 = lag(hog_future,4),
hog_return_4 = lag(hog_return,4),
hog_future_5 = lag(hog_future,5),
hog_return_5 = lag(hog_return,5),
hog_future_6 = lag(hog_future,6),
hog_return_6 = lag(hog_return,6)
)
Cattle_future <- Cattle_future  %>%
mutate(tradingDay = as.Date(Time)) %>%
rename(cattle_future = Last) %>%
rename(cattle_return = Returns) %>%
select(-Time,-CommodityCode,-ContractMonth,-YearCode,-Roll_Flag) %>%
mutate(
cattle_future_1 = lag(cattle_future,1),
cattle_return_1 = lag(cattle_return,1),
cattle_future_2 = lag(cattle_future,2),
cattle_return_2 = lag(cattle_return,2),
cattle_future_3 = lag(cattle_future,3),
cattle_return_3 = lag(cattle_return,3),
cattle_future_4 = lag(cattle_future,4),
cattle_return_4 = lag(cattle_return,4),
cattle_future_5 = lag(cattle_future,5),
cattle_return_5 = lag(cattle_return,5),
cattle_future_6 = lag(cattle_future,6),
cattle_return_6 = lag(cattle_return,6)
)
# merge data
price_list <- list(Corn,Cotton,Hogs,Cattle,Soybeans,Wheat,Corn_future,Cotton_future,Hogs_future,Cattle_future,Soybeans_future,Wheat_future)
dat_combined <- reduce(
list(Corn,Cotton,Hogs,Cattle,Soybeans,Wheat,Corn_future,Cotton_future,Hogs_future,Cattle_future,Soybeans_future,Wheat_future),
~ left_join(.x, .y, by = "tradingDay"),
.init = dat
)
View(dat_combined)
View(Hog_future)
View(Hogs_future)
View(Wheat_future)
# corn/soybean future price expectation
nrow(dat_combined)
table(dat_combined$corn_future_exceed)
table(dat_combined$corn_future_below)
table(dat_combined$soybean_future_exceed)
table(dat_combined$soybean_future_below)
dat_combined <- dat_combined %>%
mutate(corn_future_exp = case_when(
corn_future_exceed == "A" & corn_future_below == "A" ~ 0,
corn_future_exceed == "A" & corn_future_below %in% c("B", "C") ~ 1,
corn_future_exceed == "B" & corn_future_below == "A" ~ 3,
corn_future_exceed == "C" & corn_future_below == "A" ~ 3,
corn_future_exceed %in% c("B", "C") & corn_future_below %in% c("B", "C") ~ 2),
soybean_future_exp = case_when(
soybean_future_exceed == "A" & soybean_future_below == "A" ~ 0,
soybean_future_exceed == "A" & soybean_future_below %in% c("B", "C") ~ 1,
soybean_future_exceed == "B" & soybean_future_below == "A" ~ 3,
soybean_future_exceed == "C" & soybean_future_below == "A" ~ 3,
soybean_future_exceed %in% c("B", "C") & soybean_future_below %in% c("B", "C") ~ 2)
)
table(dat_combined$corn_future_exp, useNA = "ifany")
table(dat_combined$soybean_future_exp, useNA = "ifany")
dat_combined$corn_future_exp <- factor(dat_combined$corn_future_exp)
dat_combined$soybean_future_exp <- factor(dat_combined$soybean_future_exp)
# generate time series of agricultural products with the rate of change of price
commodities <- c("corn", "cotton", "hogs", "cattle", "soybeans", "wheat")
for (var in commodities) {
delta_name <- paste0("delta_", var, "_1")
dat_combined[[delta_name]] <- (dat_combined[[var]] - dat_combined[[paste0(var, "_1")]]) / dat_combined[[paste0(var, "_1")]]
for (k in 2:6) {
delta_k_name <- paste0("delta_", var, "_", k)
var_1 <- paste0(var, "_1")
var_k <- paste0(var, "_", k)
dat_combined[[delta_k_name]] <- (dat_combined[[var_1]] - dat_combined[[var_k]]) / dat_combined[[var_k]]
}
}
View(dat_combined)
